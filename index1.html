<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Borrowed Loan Manager</title>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<style>
body{font-family:Arial,sans-serif;margin:0;padding:0;background:#f6f8fb;}
.card{margin:10px;padding:12px;background:#fff;border-radius:12px;box-shadow:0 4px 18px rgba(0,0,0,0.06);}
.holder-row{display:flex;justify-content:space-between;padding:8px;border-bottom:1px solid #eee;cursor:pointer;}
.holder-meta{display:flex;gap:10px;}
.holder-id{font-weight:700;}
.muted{color:#777;font-size:12px;}
</style>
</head>
<body>

<div class="card">
  <h3>Total Holders: <span id="totalHolders">0</span></h3>
  <h3>Total Balance: <span id="totalBalance">0</span></h3>
</div>

<div class="card">
  <input type="text" id="q" placeholder="Search..." oninput="renderList()" style="width:100%;padding:8px;margin-bottom:8px;">
</div>

<div class="card" id="holdersList">Loading...</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbypxIF7Gb0_DSmwFoZKD7oEAkRniUHJ2T8Ojmk3RJ9AE4LdKvnqkpTP0g5gybaqPXmJ/exec";
let holders=[];

async function loadHolders(){
  try{
    const resp=await fetch(`${API_URL}?action=getHolders`);
    const data=await resp.json();
    holders=data;
    computeKPIs();
    renderList();
  }catch(e){
    console.error(e);
    document.getElementById('holdersList').innerHTML='<div class="muted">Failed to load holders</div>';
  }
}

function computeKPIs(){
  const total=holders.length;
  const sum=holders.reduce((s,h)=>s+Number(h.balance||0),0);
  document.getElementById('totalHolders').innerText=total;
  document.getElementById('totalBalance').innerText=sum.toFixed(2);
}

function renderList(){
  const q=document.getElementById('q').value.toLowerCase();
  const filtered=holders.filter(h=>h.name.toLowerCase().includes(q)||h.hid.toLowerCase().includes(q));
  if(!filtered.length){
    document.getElementById('holdersList').innerHTML='<div class="muted">No holders found</div>';
    return;
  }
  const html=filtered.map(h=>`
    <div class="holder-row" onclick="alert('Holder: ${h.name} | Balance: ${h.balance}')">
      <div class="holder-meta"><div class="holder-id">${h.name}</div><div class="muted">${h.hid}</div></div>
      <div>${h.balance}</div>
    </div>
  `).join("");
  document.getElementById('holdersList').innerHTML=html;
}

// Initialize
loadHolders();
</script>

</body>
</html>
